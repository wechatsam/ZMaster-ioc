{"version":3,"sources":["assets\\Script\\src\\time\\JTTimerTool.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["namespace com \r\n{\r\n    export class JTTimerTool\r\n    {\r\n        public static defaultTimer:JTTimerTool = null;\r\n        public static animationTimer:JTTimerTool = null;\r\n        public static logicTimer:JTTimerTool = null;\r\n        private _pause:boolean = false;\r\n        private _tasks:JTITimerTask[] = null;\r\n        private _currentTime:number = 0;\r\n        private static _frameRate:number = 0;\r\n        private static _frameRateTime:number = 0;\r\n\r\n        public static FAST_RATE:string = \"fast_rate\";\r\n        public static NORMAL_RATE:string = \"normal_rate\";\r\n        public static SLOWY_RATE:string = \"slowy_rate\";\r\n\r\n        public static FAST_FRAME_RATE:number = 120;\r\n        public static NORMAL_FRAME_RATE:number = 60;\r\n        public static SLOWY_FRAME_RATE:number = 30;\r\n\r\n        constructor()\r\n        {\r\n            this._tasks = [];\r\n        }\r\n\r\n\r\n        public static launch(rate:string = \"normal_rate\"):void\r\n        {\r\n            this.logicTimer = new JTTimerTool();\r\n            this.defaultTimer = new JTTimerTool();\r\n            this.animationTimer = new JTTimerTool();\r\n            switch(rate)\r\n            {\r\n                case this.FAST_RATE:\r\n                {\r\n                    this._frameRate = this.FAST_FRAME_RATE;\r\n                    break;\r\n                }\r\n                case this.NORMAL_RATE:\r\n                {\r\n                    this._frameRate = this.NORMAL_FRAME_RATE;\r\n                    break;\r\n                }\r\n                case this.SLOWY_RATE:\r\n                {\r\n                    this._frameRate = this.SLOWY_FRAME_RATE;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        public static get frameRate():number\r\n        {\r\n             return this._frameRate;\r\n        }\r\n\r\n        public static get frameRateTime():number\r\n        {\r\n            if (this._frameRateTime == 0)\r\n            {\r\n                this._frameRateTime = 1000 / this._frameRate;\r\n            }\r\n            return this._frameRateTime;\r\n        }\r\n\r\n        public stop():void\r\n        {\r\n            this._pause = true;\r\n            this._currentTime = 0;\r\n        }\r\n\r\n        public static actives():void\r\n        {\r\n            this.defaultTimer.active();\r\n            this.animationTimer.active();\r\n            this.logicTimer.active();\r\n        }\r\n\r\n        /**\r\n         * 如果要使用优化计时器，需要外部计时器回调函数调用此方法\r\n         */\r\n        public active():void\r\n        {\r\n            if (this._currentTime == 0)\r\n            {\r\n                this._currentTime = JTTimeUtils.runnbleTime;\r\n                return;\r\n            }\r\n            if (this._pause) return;\r\n            let nowTime:number = JTTimeUtils.runnbleTime;\r\n            let tick:number = nowTime - this._currentTime;\r\n            this.updateTicks(tick);//统一时间，每一计时器任务根据情况做不同的事\r\n            this.updateTasks();\r\n            this._currentTime = nowTime;\r\n        }\r\n\r\n        protected updateTicks(tick:number):void\r\n        {\r\n            let total:number = this._tasks.length;\r\n            for (let i:number = 0; i < total; i++)\r\n            {\r\n                let task:JTITimerTask = this._tasks[i];\r\n                task.running && task.updateTick(tick);\r\n            }\r\n        }\r\n\r\n        protected updateTasks():void\r\n        {\r\n            for (let i:number = 0; i < this._tasks.length; i++)\r\n            {\r\n                let task:JTITimerTask = this._tasks[i];\r\n                if (!task.running)\r\n                {\r\n                    this._tasks.splice(i, 1);\r\n                    i --\r\n                }\r\n            }\r\n        }\r\n\r\n        public addTask(task:JTITimerTask):void\r\n        {\r\n            let index:number = this._tasks.indexOf(task);\r\n            if (index != -1) return;\r\n            this._tasks.push(task);\r\n        }\r\n\r\n        public removeTask(task:JTITimerTask):void\r\n        {\r\n            let index:number = this._tasks.indexOf(task);\r\n            if (index != -1) return;\r\n            this._tasks.splice(index, 1);\r\n        }\r\n\r\n        public put(task:JTITimerTask):void\r\n        {\r\n            let index:number = this._tasks.indexOf(task);\r\n            if (index != -1) return;\r\n            this._tasks.splice(index, 1);\r\n            JTPool.instance(task[\"constructor\"]).put(task as any);\r\n        }\r\n    }\r\n}\r\n"]}